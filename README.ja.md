Redmineチケット順位プラグイン
=============================

チケットに順位をつけ、変更時にプロジェクト内の全チケットの順位を自動調整するプラグインです。

## サポートされるRedmineとRubyのバージョン

* Redmine 2.4.1、Ruby 1.9.3-p551で開発・動作確認しました。
* 他のバージョンも将来サポートするかもしれません。

## プラグインのインストール

redmineのpluginsディレクトリで以下のコマンドを実行します。

```
git clone https://github.com/hnakamur/redmine_issue_rank
```

その後redmineを再起動します。


## プラグインインストール後の設定

* ブラグインの設定画面で「順位として使用するカスタムフィールドの名前」を設定してください（例：順位）
* それと同じ名前で整数のカスタムフィールドを作成してください。
   * 「全プロジェクト向け」、「フィルタとして使う」はオンにします。
* 「ロールと権限」画面で「チケット一覧の表示順で順位を一括更新」の権限を使用したいロールでオンにしてください。
* プロジェクト毎の設定の「モジュール」タブで「チケットの順位」をオンにしてください。
* チケット一覧ページでカスタムクエリを作成してください。
    * ソート条件は順位の昇順にします。
    * 項目には順位を含めます。
    * 他の項目はお好みで設定してください。お勧めは次の通りです。
       * 「表示」は「すべてのユーザー」
       * 「全プロジェクト向け」をオン
           * ただし一度オンにするとオフにはできないのでご注意ください。


## 使い方

* チケットを保存すると、プロジェクト内の全チケットの順位が自動的に調整されます。
* チケット一覧でソート順を適宜調整してサイドバーの「チケットの順位を現在の表示順で一括更新する」メニューをクリックすると一覧の表示順に合わせて順位を一括更新できます。ソート順は以下の通りです。
   1. チケット一覧に表示されているチケットの後に非表示のチケット
   2. チケット一覧に表示されているチケットはその順
   3. 表示されていない場合はRankの値順
   4. 表示されていなくてRankが同じ場合はチケットID順
* 個々のチケットの順位はチケット編集画面で変更できます。
   * 保存すると、プロジェクト内の全チケットの順位が調整されます。
   * 同じ順位のチケットがある場合は、変更したチケットが優先となり同じ順位の他のチケットはその次の順位になります。
   * 順位は1から順に詰めて調整されます。そのため、チケット編集画面で入力した値と同じになるとは限りません。
* チケットのステータスを未完了から完了か完了から未完了に変えた場合、未完了のチケットの最大の順位の次の順位に設定されます。そしてプロジェクト内の全チケットの順位が調整されます。


## プラグインのアンインストール

* redmineのpluginsディレクトリの下のredmine_issue_rankディレクトリを削除します。
* redmineのデータベースで以下のSQLを実行し、このプラグイン用の設定を削除します。

```
DELETE FROM settings WHERE name = 'plugin_redmine_issue_rank';
```

* 順位用のカスタムフィールドとカスタムクエリを削除します。
* redmineを再起動します。


## ライセンス

MIT
