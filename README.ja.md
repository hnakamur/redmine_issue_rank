Redmineチケット順位プラグイン
=============================

チケットに順位をつけ、変更時にプロジェクト内の全チケットの順位を自動調整するプラグインです。

## サポートされるRedmineとRubyのバージョン

* Redmine 2.4.1、Ruby 1.9.3-p551で開発・動作確認しました。
* 他のバージョンも将来サポートするかもしれません。

## プラグインのインストール

redmineのpluginsディレクトリで以下のコマンドを実行します。

```
git clone https://github.com/hnakamur/redmine_issue_rank
```

その後redmineを再起動します。


## プラグインインストール後の設定

* ブラグインの設定画面で「順位として使用するカスタムフィールドの名前」を設定してください（例：順位）
* それと同じ名前で整数のカスタムフィールドを作成してください。
   * 「全プロジェクト向け」、「フィルタとして使う」はオンにします。
* 「ロールと権限」画面で「チケット一覧の表示順で順位を一括更新」の権限を使用したいロールでオンにしてください。
* プロジェクト毎の設定の「モジュール」タブで「チケットの順位」をオンにしてください。
* チケット一覧ページでカスタムクエリを作成してください（名前の例:「順位付き」）。
    * プロジェクトがサブプロジェクトを持つ場合は、フィルタでサブプロジェクトをなしに設定します。
    * ソート条件は順位の昇順にします。
    * オプションの選択された項目には順位を含めます。
    * 他の項目はお好みで設定してください。お勧めは次の通りです。
       * 「表示」は「すべてのユーザー」
       * 「全プロジェクト向け」をオン
           * ただし一度オンにするとオフにはできないのでご注意ください。気になる場合は「全プロジェクト向け」はオフでご利用ください。


## 使い方

* チケットを保存すると、プロジェクト内の全チケットの順位が自動的に調整されます。
* チケット一覧でソート順を適宜調整してサイドバーの「チケットの順位を現在の表示順で一括更新する」メニューをクリックすると一覧の表示順に合わせて順位を一括更新できます。
   * 一括更新する際には予めチケット一覧のフィルタリングを以下のように設定してください。
       * プロジェクトのサブプロジェクトが存在する場合、サプブロジェクトをなしにするフィルタを設定
   * チケット一覧の表示順に合わせて順位が更新されます。ただし、カスタムフィールドの設定で有効にしたトラッカー以外のチケットには順位は設定されません。また、チケットの順位は1から順に適宜調整されます。
       1. 一覧に表示されているチケットが表示順に1から順位付けされます。
       2. 一覧に表示されていないチケットのうち順位が設定済みのものが、順位の順番に並べられます。
       3. 一覧に表示されていないチケットのうち順位が未設定のものは、チケットID降順に並べられます。
   * まずプロジェクトの全てのチケットを表示させて順位を一括更新した後、フィルタを設定して一部のチケットのみの順位を一括更新するということも可能です。
* 個々のチケットの順位はチケット編集画面で変更できます。
   * 保存すると、プロジェクト内の全チケットの順位が調整されます。
   * 同じ順位のチケットがある場合は、変更したチケットが優先となり同じ順位の他のチケットはその次の順位になります。
   * 順位は1から順に詰めて調整されます。そのため、チケット編集画面で入力した値と同じになるとは限りません。
* チケットのステータスを未完了から完了か完了から未完了に変えた場合、未完了のチケットの最大の順位の次の順位に設定されます。そしてプロジェクト内の全チケットの順位が調整されます。


## プラグインのアンインストール

* redmineのpluginsディレクトリの下のredmine_issue_rankディレクトリを削除します。
* redmineのデータベースで以下のSQLを実行し、このプラグイン用の設定を削除します。

```
DELETE FROM settings WHERE name = 'plugin_redmine_issue_rank';
```

* 順位用のカスタムフィールドとカスタムクエリを削除します。
* redmineを再起動します。


## ライセンス

MIT
